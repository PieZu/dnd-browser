<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8">
    <title>DND Spell Browser</title>
  </head>
  
  <body>
    <div id="search">
      <label for="spellid">ID:</label>
      <input type="text" id="spellid" name="id">
      <button onclick="loadSpell()">Load</button>
      <br>
      <label for="spellfilter">Filter Query:</label>
      <input type="text" id="spellfilter" name="query">
      <button onclick="findSpell()">Search</button>
    </div>
      
    <div id="spell display">
    </div>
    
    <script>
      function loadSpell(id = document.getElementById("spellid").value) {
        fetch("/spell/"+id, {})
          .then(res => res.json())
          .then(spell => {
            document.getElementById("spell display").innerHTML = displaySpell(spell)
          });
        }
      
      function findSpell(filter = document.getElementById("spellfilter").value) {
        let body = {query: filter}
        fetch("/spells/", {method: "post", headers: {'Content-Type': 'application/json'}, body: JSON.stringify(body)}) 
          .then(res => {console.log(res);return res.json()})
          .then(spells => {
            console.log(spells)
            document.getElementById("spell display").innerHTML =""
            spells.forEach(spell=>{document.getElementById("spell display").innerHTML += displaySpell(spell)})
          });
        }
      
        function displaySpell(spell) {
          console.log(spell)
          var school 
          switch (spell.level) {
            case 0:
              school = spell.school+" Cantrip"
              break
            case 1:
              school = "1st level "+spell.school
              break
            case 2:
              school = "2nd level "+spell.school
              break
            case 3:
              school = "3rd level "+spell.school
              break
            default:
              school = spell.level+"th level "+spell.school
          } 
          
          let components = []
          for (let i=0; i <3; i++) { if ([spell.verbal, spell.somatic, spell.material][i]) components.push("VSM"[i]) } // yes theres probably a way to do this more elegantly but hey this was has the string 'i <3' which is cute
          
          return `
            <h1 class="Name"> ${spell.spell_name} </h1>
            <em class="School"> ${school} </em>
            <br>Usable by: <em>${spell.classes}</em>
              
            <p>
              <br>Components: <strong>${components.join(", ")}</strong>
              ${components.includes("M")? "<br>Materials: <strong>"+spell.materials+"</strong>" :""}
              <br>Casting time: <strong>${spell.casttime}</strong>
              <br>Duration: <strong>${spell.duration}</strong>
              <br>Range: <strong>${spell.range}</strong>

              <br><br>
              ${spell.spell_description}
            </p>
            `
        }
    </script>
  </body>
</html>